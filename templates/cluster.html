<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cluster test</title>
    <link href="{{ url_for('static', filename='node_modules/bootstrap/dist/css/bootstrap.min.css') }}" rel="stylesheet"
          type="text/css"/>
    <script src="{{ url_for('static', filename='node_modules/bootstrap/dist/js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='node_modules/vis-network/standalone/umd/vis-network.min.js') }}"></script>

    <script type="text/javascript">

        let nodes;
        let edges;
        let data;
        let hiddenData = {nodes: new vis.DataSet(), edges: new vis.DataSet()};

        function draw() {
            nodes = new vis.DataSet(
            	[{id:'1',label:'1',cid:1},
            	{id:'2',label:'2',cid:1},
            	{id:'3',label:'3'}]);
            
            edges = new vis.DataSet(
            	[{from:'1', to:'2', arrows:'to'},{from:'1', to:'3', arrows:'to'},
            	{from:'2', to:'1', arrows:'to'},{from:'2', to:'3', arrows:'to'},
            	{from:'3', to:'1', arrows:'to'},{from:'3', to:'2', arrows:'to'}]);
            data = {nodes: nodes, edges: edges};

            // create a network
            var container = document.getElementById("mynetwork");

            var options = {
                interaction: {
                    zoomSpeed: 3
                },
                edges: {
                    smooth: {
                        forceDirection: "none",
                        roundness: 0
                    }
                },
                layout: {
                    improvedLayout: false
                },
                physics: {
                    barnesHut: {
                        gravitationalConstant: -758211,
                        centralGravity: 0.6,
                        avoidOverlap: 1
                    },
                    stabilization: false,
                    timestep: 0.3,
                    wind: {x: 0, y: 0},
                },
            };

            network = new vis.Network(container, data, options);
        }

        function deleteNodes(nodeIDS) {
            network.selectNodes(nodeIDS, false);
            console.log(network.getSelection());
            network.deleteSelected();
        }

        function stopSimulation() {
            network.stopSimulation();
        }


        function nodesList() {
            let data = nodes.getIds();
            let list = document.getElementById("nodes-list");
            for (i = 0; i < data.length; ++i) {
                var li = document.createElement('li');
                li.innerText = data[i];
                list.appendChild(li);
            }
        }

        function changeColor(c){
            let node1 = nodes.get('__delay');
            node1.color = c;

            let node2 = nodes.get('pin_page_for_write');
            node2.color = c;
            nodes.updateOnly([node1,node2]);
        }

        function hideNode(id){
            var n = nodes.get(id); // get the node
            var e = edges.get({filter: function(item){return (item.from == id)}}) // get the edges
            hiddenData.nodes.add(n);
            hiddenData.edges.add(e);
            nodes.remove(id);
            edges.remove(e);
        }

        function showNode(id){
            var n = hiddenData.nodes.get(id); // get the node
            var e = hiddenData.edges.get({filter: function(item){return (item.from == id)}}) // get the edges
            nodes.add(n);
            edges.add(e);
            hiddenData.nodes.remove(id);
            hiddenData.edges.remove(e);
        }

        function clusterById(id){
        	var clusterOptions = {
        		joinCondition: function(param){
        			console.log(param)
        			return param.cid == '1';
        		}, 
        		clusterNodeProperties:{ id : "cluster1" },
        		clusterEdgeProperties:{ arrows:"to,from"},
        	};
        	network.clustering.cluster(clusterOptions);
        }

    </script>


</head>
<body onload="draw();">

<div class="container mt-5 border border-primary">
        <button type="button" class="btn btn-danger" onclick="stopSimulation();">Stop</button>
        <button type="button" class="btn btn-danger" onclick="deleteNodes(['unlikely','likely']);">Delete Nodes</button>
        <button type="button" class="btn btn-success" onclick="clusterById('1');">Cluster by ID</button>
        <button type="button" class="btn btn-primary" onclick="retrieveData();">Retrieve Data</button>
        <button type="button" class="btn btn-primary" onclick="nodesList();">Generate List</button>
        <button type="button" class="btn btn-outline-danger" onclick="changeColor('red');">Change color</button>
        <button type="button" class="btn btn-outline-primary" onclick="changeColor('blue');">Reset color</button>
        <button type="button" class="btn btn-danger" onclick="hideNode('1');">Hide Node</button>
        <button type="button" class="btn btn-success" onclick="showNode('1');">Show Node</button>
</div>

<div class="container my-5 border border-primary">
    <div id="mynetwork" style="height: 600px"></div>
</div>

<div class="container my-5 p-3 border border-primary">
    <h5>Nodes list</h5>
    <ul id="nodes-list">
        <li>fst node</li>
    </ul>
</div>

</body>
</html>